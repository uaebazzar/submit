<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Luncher | User Insights</title>
    <style>
        :root {
            --bg: #ffffff;
            --text-primary: #000000;
            --text-secondary: #6b7280;
            --border-soft: #f3f4f6;
            --border-active: #000000;
            --radius-lg: 20px;
            --radius-sm: 12px;
            --font-main: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        /* Enforce absolute stability */
        html, body {
            overflow: hidden;
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            position: fixed;
            background-color: var(--bg);
            color: var(--text-primary);
            font-family: var(--font-main);
            -webkit-font-smoothing: antialiased;
            touch-action: none;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 380px;
            padding: 24px;
            box-sizing: border-box;
        }

        .hidden { display: none !important; }

        /* Typography */
        h1 {
            font-size: 34px;
            font-weight: 800;
            margin: 0 0 12px 0;
            letter-spacing: -1.5px;
            line-height: 1;
        }

        .subtitle {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 40px;
            line-height: 1.5;
            font-weight: 400;
        }

        /* Modern Vertical Toggles */
        .options-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .options-group input[type="radio"] {
            display: none;
        }

        .options-group label {
            display: block;
            padding: 18px 24px;
            border: 1.5px solid var(--border-soft);
            border-radius: var(--radius-sm);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            background: #fafafa;
        }

        .options-group input[type="radio"]:checked + label {
            background-color: var(--text-primary);
            color: var(--bg);
            border-color: var(--text-primary);
            transform: scale(1.02);
        }

        /* Custom Input Area */
        #custom-area {
            margin-top: -10px;
            margin-bottom: 24px;
            animation: slideDown 0.3s ease-out;
        }

        textarea {
            width: 100%;
            padding: 16px;
            border: 1.5px solid var(--border-soft);
            border-radius: var(--radius-sm);
            font-family: var(--font-main);
            font-size: 14px;
            resize: none;
            box-sizing: border-box;
            outline: none;
            transition: border-color 0.2s;
        }

        textarea:focus {
            border-color: var(--text-primary);
        }

        /* Interaction */
        .cta-button {
            width: 100%;
            padding: 22px;
            background-color: var(--text-primary);
            color: var(--bg);
            border: none;
            border-radius: var(--radius-lg);
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: opacity 0.2s, transform 0.1s;
        }

        .cta-button:active {
            transform: scale(0.97);
        }

        .metrics {
            display: block;
            margin-top: 24px;
            font-size: 12px;
            color: var(--text-secondary);
            text-align: center;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        /* Final State UI */
        .status-badge {
            width: 40px;
            height: 4px;
            background: #000;
            margin-bottom: 30px;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

    <div class="container">
        <div id="form-view">
            <h1>Share Your Experience</h1>
            <p class="subtitle">How would you characterize the current Luncher ecosystem?</p>
            
            <form id="insightForm">
                <div class="options-group">
                    <input type="radio" id="opt1" name="rating" value="Exceptional" required>
                    <label for="opt1">Exceptional</label>

                    <input type="radio" id="opt2" name="rating" value="Reliable">
                    <label for="opt2">Reliable</label>

                    <input type="radio" id="opt3" name="rating" value="Functional">
                    <label for="opt3">Functional</label>

                    <input type="radio" id="opt4" name="rating" value="Suboptimal">
                    <label for="opt4">Suboptimal</label>

                    <input type="radio" id="opt_custom" name="rating" value="Custom">
                    <label for="opt_custom">Custom Feedback</label>
                </div>

                <div id="custom-area" class="hidden">
                    <textarea id="custom_text" placeholder="Elaborate on your experience..." rows="3"></textarea>
                </div>

                <button type="submit" class="cta-button">Confirm Submission</button>
            </form>
            <span class="metrics" id="globalCounter">Syncing global data...</span>
        </div>

        <div id="complete-view" class="hidden">
            <div class="status-badge"></div>
            <h1>Contribution Received</h1>
            <p class="subtitle">Your perspective has been integrated into the Luncher roadmap. This device has already participated in this cycle.</p>
            <span class="metrics" id="finalCounter"></span>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, set, onValue, runTransaction, push } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCpJpI-WmQ9Ag4UVbB5qvkVb87YZdJGIkM",
            authDomain: "submit-e377f.firebaseapp.com",
            databaseURL: "https://submit-e377f-default-rtdb.firebaseio.com",
            projectId: "submit-e377f",
            storageBucket: "submit-e377f.firebasestorage.app",
            messagingSenderId: "297455477288",
            appId: "1:297455477288:web:3e23c36cc4f465c233cb1d",
            measurementId: "G-7QR1GK35CD"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const formView = document.getElementById('form-view');
        const completeView = document.getElementById('complete-view');
        const customArea = document.getElementById('custom-area');
        const counterEl = document.getElementById('globalCounter');
        const finalCounterEl = document.getElementById('finalCounter');

        // Toggle Custom Textarea
        document.querySelectorAll('input[name="rating"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                if(e.target.id === 'opt_custom') {
                    customArea.classList.remove('hidden');
                } else {
                    customArea.classList.add('hidden');
                }
            });
        });

        // Realtime Global Listener
        const countRef = ref(db, 'stats/submitCount');
        onValue(countRef, (snap) => {
            const count = snap.val() || 0;
            const msg = `${count.toLocaleString()} Contributions Logged`;
            counterEl.innerText = msg;
            finalCounterEl.innerText = msg;
        });

        // Persistent Device Lock
        if (localStorage.getItem('luncher_auth_vote') === 'true') {
            showSuccess();
        }

        // Handle Submission
        document.getElementById('insightForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const rating = document.querySelector('input[name="rating"]:checked').value;
            const customText = document.getElementById('custom_text').value;

            try {
                // Record data
                const subRef = push(ref(db, 'submissions'));
                await set(subRef, {
                    category: rating,
                    feedback: rating === 'Custom' ? customText : 'N/A',
                    timestamp: Date.now()
                });

                // Atomic counter update
                await runTransaction(countRef, (curr) => (curr || 0) + 1);

                localStorage.setItem('luncher_auth_vote', 'true');
                showSuccess();
            } catch (err) {
                console.error("Transmission error:", err);
            }
        });

        function showSuccess() {
            formView.classList.add('hidden');
            completeView.classList.remove('hidden');
        }
    </script>
</body>
</html>
